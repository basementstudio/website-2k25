import Image from "next/image"
import Link from "next/link"

import { Placeholder } from "@/components/primitives/placeholder"
import { cn } from "@/utils/cn"

import { FilteredProjectType } from "./project-list"

const GRID_COLS = 6
const REGULAR_ITEM_COLS = 3

export const Grid = ({ projects }: { projects: FilteredProjectType[] }) => {
  const calculatePlaceholders = () => {
    if (projects.length === 0) return []

    const remainingItems = projects.length - 1
    const itemsPerRow = GRID_COLS / REGULAR_ITEM_COLS

    // calculate total rows needed (first row has only first item)
    const regularRows = Math.ceil(remainingItems / itemsPerRow)
    const totalCells = regularRows * itemsPerRow

    // calculate how many placeholders we need
    const placeholdersNeeded = totalCells - remainingItems

    return Array(placeholdersNeeded).fill(null)
  }

  const placeholders = calculatePlaceholders()

  return (
    <div className="grid-layout">
      {projects.map((item, index) => {
        const firstItem = index === 0

        return (
          <div
            key={item._title + index}
            className={cn(
              "relative",
              firstItem ? "col-span-6 row-span-2" : "col-span-3",
              "group aspect-[418/296] cursor-pointer after:pointer-events-none after:absolute after:inset-0 after:border after:border-brand-w1/20",
              item.disabled && "pointer-events-none"
            )}
          >
            <Link
              href={`/projects/${item.project?._slug}`}
              className={cn("with-dots block h-full w-full", {
                "pointer-events-none": item.disabled
              })}
            >
              {item.disabled && (
                <Placeholder
                  className="absolute inset-0 text-brand-w1/20"
                  width={418}
                  height={296}
                />
              )}
              <Image
                src={item.cover?.url ?? ""}
                alt={item.cover?.alt ?? ""}
                width={item.cover?.width ?? 0}
                height={item.cover?.height ?? 0}
                className={cn(
                  "absolute inset-0 object-cover opacity-0 transition-opacity duration-300",
                  !item.disabled && "opacity-100 group-hover:opacity-70"
                )}
              />

              {!item.disabled && (
                <div
                  className={cn(
                    "pointer-events-none absolute inset-0 flex flex-col justify-center opacity-0 transition-opacity duration-300 group-hover:opacity-100",
                    firstItem && "h-[calc(50%-2px)]"
                  )}
                >
                  <div className={cn("grid grid-cols-12 bg-brand-k px-2")}>
                    <p className="col-span-4 text-p text-brand-w1">
                      {item.project?.client?._title}
                    </p>

                    <p className="col-span-8 inline-flex flex-wrap text-pretty text-p text-brand-w1">
                      {item.project?.categories?.map((cat, idx) => {
                        return (
                          <span key={cat._title}>
                            {cat._title}
                            {idx !==
                              (item.project?.categories?.length ?? 0) - 1 && (
                              <span className="inline-block px-1 text-brand-g1">
                                ,
                              </span>
                            )}
                          </span>
                        )
                      })}
                    </p>
                  </div>
                </div>
              )}
            </Link>
          </div>
        )
      })}

      {/* Add placeholder items to fill the grid */}
      {placeholders.map((_, index) => (
        <div
          key={`placeholder-${index}`}
          className="with-dots col-span-3 aspect-[418/296] overflow-hidden border border-brand-w1/20"
        >
          <GridFiller />
        </div>
      ))}
    </div>
  )
}

const GridFiller = () => (
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 418 296">
    <g clipPath="url(#clip0_2488_41377)">
      <path fill="#000" d="M0 0h418v296H0z"></path>
      <g stroke="#E6E6E6" clipPath="url(#clip1_2488_41377)" opacity="0.2">
        <path d="m-568.646 226.354 857-857M-565.818 229.182l857-857M-562.99 232.01l857-856.999M-560.161 234.839l857-857M-557.332 237.668l857-857M-554.504 240.496l857-857M-551.675 243.324l857-857M-548.847 246.153l857-857M-546.02 248.98l857-856.999M-543.19 251.81l857-857M-540.362 254.638l857-857M-537.533 257.467l857-857M-534.705 260.295l857-857M-531.876 263.123l857-857M-529.048 265.952l857-857M-526.22 268.78l857-857M-523.391 271.609l857-857M-520.563 274.437l857-857M-517.734 277.266l857-857M-514.906 280.094l857-857M-512.077 282.922l857-857M-509.25 285.75l857-856.999M-506.421 288.579l857-857M-503.592 291.408l857-857M-500.764 294.236l857-857M-497.935 297.065l857-857M-495.107 299.893l857-857M-492.278 302.72l857-856.999M-489.45 305.55l857-857M-486.622 308.378l857-857M-483.793 311.207l857-857M-480.965 314.035l857-857M-478.136 316.864l857-857M-475.308 319.692l857-857M-472.48 322.52l857-857M-469.651 325.349l857-857M-466.823 328.177l857-857M-463.994 331.006l857-857M-461.166 333.834l857-857M-458.337 336.663l857-857M-455.51 339.49l857-856.999M-452.68 342.319l857-857M-449.852 345.148l857-857M-447.024 347.976l857-857M-444.195 350.805l857-857M-441.367 353.633l857-857M-438.538 356.462l857-857M-435.71 359.29l857-857M-432.881 362.118l857-857M-430.053 364.947l857-857M-427.225 367.775l857-857M-424.396 370.604l857-857M-421.568 373.432l857-857M-418.74 376.26l857-856.999M-415.911 379.089l857-857M-413.083 381.917l857-857M-410.254 384.746l857-857M-407.426 387.574l857-857M-404.597 390.403l857-857M-401.77 393.23l857-856.999M-398.94 396.06l857-857M-396.112 398.888l857-857M-393.283 401.716l857-857M-390.455 404.545l857-857M-387.627 407.373l857-857M-384.798 410.202l857-857M-381.97 413.03l857-857M-379.141 415.858l857-857M-376.313 418.687l857-857M-373.484 421.515l857-857M-370.656 424.344l857-857M-367.828 427.172l857-857M-365 430l857-856.999M-362.171 432.829l857-857M-359.342 435.657l857-857M-356.514 438.486l857-857M-353.686 441.314l857-857M-350.857 444.143l857-857M-348.03 446.97l857-856.999M-345.2 449.8l857-857M-342.372 452.628l857-857M-339.543 455.456l857-857M-336.715 458.285l857-857M-333.886 461.113l857-857M-331.058 463.942l857-857M-328.23 466.77l857-857M-325.401 469.599l857-857M-322.573 472.427l857-857M-319.744 475.255l857-857M-316.916 478.084l857-857M-314.087 480.912l857-857M-311.26 483.74l857-856.999M-308.431 486.569l857-857M-305.602 489.398l857-857M-302.774 492.226l857-857M-299.945 495.054l857-857M-297.117 497.883l857-857M-294.29 500.71l857-856.999M-291.46 503.54l857-857M-288.632 506.368l857-857M-285.803 509.197l857-857M-282.975 512.025l857-857M-280.146 514.853l857-857M-277.318 517.682l857-857M-274.49 520.51l857-857M-271.661 523.339l857-857M-268.833 526.167l857-857M-266.004 528.996l857-857M-263.176 531.824l857-857M-260.347 534.652l857-857M-257.52 537.48l857-856.999M-254.69 540.309l857-857M-251.862 543.138l857-857M-249.034 545.966l857-857M-246.205 548.795l857-857M-243.377 551.623l857-857M-240.548 554.45l857-856.999M-237.72 557.28l857-857M-234.892 560.108l857-857M-232.063 562.937l857-857M-229.235 565.765l857-857M-226.406 568.594l857-857M-223.578 571.422l857-857M-220.75 574.25l857-857M-217.921 577.079l857-857M-215.093 579.907l857-857M-212.264 582.736l857-857M-209.436 585.564l857-857M-206.607 588.393l857-857M-203.78 591.22l857-856.999M-200.95 594.049l857-857M-198.122 596.878l857-857M-195.293 599.706l857-857M-192.465 602.535l857-857M-189.637 605.363l857-857M-186.808 608.192l857-857M-183.98 611.02l857-857M-181.151 613.848l857-857M-178.323 616.677l857-857M-175.495 619.505l857-857M-172.666 622.334l857-857M-169.838 625.162l857-857M-167.01 627.99l857-856.999M-164.181 630.819l857-857M-161.353 633.647l857-857M-158.524 636.476l857-857M-155.696 639.304l857-857M-152.867 642.133l857-857M-150.04 644.96l857-856.999M-147.21 647.79l857-857M-144.382 650.618l857-857M-141.553 653.446l857-857M-138.725 656.275l857-857M-135.896 659.103l857-857M-133.068 661.932l857-857M-130.24 664.76l857-857M-127.411 667.588l857-857M-124.583 670.417l857-857M-121.754 673.245l857-857M-118.926 676.074l857-857M-116.098 678.902l857-857M-113.27 681.73l857-856.999M-110.441 684.559l857-857M-107.612 687.387l857-857M-104.784 690.216l857-857M-101.956 693.044l857-857M-99.127 695.873l857-857M-96.299 698.7l857-856.999M-93.47 701.53l856.999-857M-90.642 704.358l857-857M-87.814 707.186l857-857M-84.985 710.015l857-857M-82.157 712.843l857-857M-79.329 715.672l857-857M-76.5 718.5l857-857M-73.672 721.329l857-857M-70.843 724.157l857-857M-68.015 726.985l857-857M-65.186 729.814l857-857M-62.358 732.642l857-857M-59.53 735.47l857-856.999M-56.701 738.299l857-857M-53.873 741.128l857-857M-51.044 743.956l857-857M-48.216 746.784l857-857M-45.387 749.613l857-857M-42.559 752.44l857-856.999M-39.73 755.27l857-857M-36.902 758.098l857-857M-34.074 760.927l857-857M-31.245 763.755l857-857M-28.417 766.583l857-857M-25.588 769.412l857-857M-22.76 772.24l857-857M-19.932 775.069l857-857M-17.103 777.897l857-857M-14.275 780.726l857-857M-11.446 783.554l857-857M-8.618 786.382l857-857M-5.79 789.21l857-856.999M-2.96 792.039l856.999-857M-.133 794.868l857-857M2.696 797.696l857-857M5.524 800.525l857-857M8.353 803.353l857-857M11.181 806.18l857-856.999M14.01 809.01l857-857M16.838 811.838l857-857M19.667 814.667l857-857M22.495 817.495l857-857M25.323 820.324l857-857M28.152 823.152l857-857M30.98 825.98l857-857M33.809 828.809l857-857M36.637 831.637l857-857M39.465 834.466l857-857M42.294 837.294l857-857M45.122 840.123l857-857M47.95 842.95l857-856.999M50.78 845.779l856.999-857M53.607 848.608l857-857M56.436 851.436l857-857M59.264 854.265l857-857M62.093 857.093l857-857M64.921 859.922l857-857M67.75 862.75l857-857M70.578 865.578l857-857M73.407 868.407l857-857M76.235 871.235l857-857M79.064 874.064l857-857M81.892 876.892l857-857M84.72 879.72l857-856.999M87.549 882.549l857-857M90.377 885.377l857-857M93.206 888.206l857-857M96.034 891.034l857-857M98.862 893.863l857-857M101.69 896.69l857-856.999M104.52 899.52l857-857M107.348 902.348l857-857M110.177 905.176l857-857M113.005 908.005l857-857M115.833 910.833l857-857M118.662 913.662l857-857M121.49 916.49l857-857M124.319 919.319l857-857M127.147 922.147l857-857M129.976 924.975l857-857M132.804 927.804l857-857"></path>
      </g>
    </g>
    <defs>
      <clipPath id="clip0_2488_41377">
        <path fill="#fff" d="M0 0h418v296H0z"></path>
      </clipPath>
      <clipPath id="clip1_2488_41377">
        <path fill="#fff" d="M-144 0h708v297h-708z"></path>
      </clipPath>
    </defs>
  </svg>
)
